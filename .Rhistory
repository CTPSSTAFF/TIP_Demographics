)
# possible_fields <- c(TotalPop_round,
#   MinPop_round,
#   MinPerc,
#   lt_2x_pov_est_round,
#   lt_2x_pov_perc,
#   lep_round,
#   lep_perc,
#   u18_round,
#   u18_perc,
#   p75_round,
#   p75_perc,
#   disab_round,
#   disab_perc)
final <- all_vars_round_pops %>% select(
all_of(proj_id_field_name),
TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc
)
write.csv(final, output_table)
View(final)
View(buf_bg)
View(buf_bg_acs)
View(buf_bg_cen)
View(buf_tract_acs)
View(acstrts)
View(bg_acs)
View(tract_cen20)
tract_acs <- merge(tract_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), acstrts, by.x ='geoid', by.y ='GEOID')
tract_acs[is.na(tract_acs)] <- 0
View(tract_acs)
#2020 Census
bg_cen$TotalPop_AF <- round(bg_cen$P2_001N*bg_cen$area_fraction)
bg_cen$MinPop_AF   <- round(bg_cen$MinPop*bg_cen$area_fraction)
#2020 ACS - BGs
#POV & 2x POV level
bg_acs$pov_stat_det_est_AF <- bg_acs$pov_stat_det_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_est_AF    <- bg_acs$lt_2x_pov_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_moe_AF    <- bg_acs$lt_2x_pov_moe*bg_acs$area_fraction
####HOUSEHOLDS - 0VEH AND LOWINC####
bg_acs$acs_hh_AF          <- bg_acs$acs_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_AF     <- bg_acs$acs_0veh_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_shr_AF <- bg_acs$acs_0veh_hh_shr*bg_acs$area_fraction
bg_acs$acs_tot_hh_AF      <- bg_acs$acs_tot_hh*bg_acs$area_fraction
bg_acs$acs_low_inc_hh_AF  <- bg_acs$acs_low_inc_hh*bg_acs$area_fraction
####LEP####
bg_acs$acs_pop_5p_AF  <- bg_acs$acs_pop_5p*bg_acs$area_fraction
bg_acs$acs_lep_pop_AF <- bg_acs$acs_lep_pop*bg_acs$area_fraction
####ACS AGE AND HH#####
bg_acs$bg_pop75p_AF <- bg_acs$bg_pop75p*bg_acs$area_fraction
bg_acs$bg_pop18u_AF <- bg_acs$bg_pop18u*bg_acs$area_fraction
bg_acs$bg_totpop_AF <- bg_acs$bg_totpop*bg_acs$area_fraction
#2020 ACS - Tracts
tract_acs$acs_noninst_pop_AF    <- tract_acs$acs_noninst_pop*tract_acs$area_fraction
tract_acs$acs_sr_noninst_pop_AF <- tract_acs$acs_sr_noninst_pop*tract_acs$area_fraction
tract_acs$acs_disab_pop_AF      <- tract_acs$acs_disab_pop*tract_acs$area_fraction
tract_acs$acs_sr_disab_pop_AF   <- tract_acs$acs_sr_disab_pop*tract_acs$area_fraction
tract_acs$acs_pop16p_AF         <- tract_acs$acs_pop16p*tract_acs$area_fraction
tract_acs$acs_workers16p_AF     <- tract_acs$acs_workers16p*tract_acs$area_fraction
buf_bg_cen <- bg_cen %>% group_by_at(proj_id_field_name) %>% summarise(
TotalPop = sum(TotalPop_AF),
MinPop = sum(MinPop_AF)
)
buf_bg_acs <- bg_acs %>% group_by_at(proj_id_field_name) %>% summarise(
pov_stat_det_est = sum(pov_stat_det_est_AF),
lt_2x_pov_est = sum(lt_2x_pov_est_AF),
lt_2x_pov_moe = sum(lt_2x_pov_moe_AF),
acs_hh = sum(acs_hh_AF),
acs_0veh_hh = sum(acs_0veh_hh_AF),
acs_0veh_hh_shr = sum(acs_0veh_hh_shr_AF),
acs_tot_hh = sum(acs_tot_hh_AF),
acs_low_inc_hh = sum(acs_low_inc_hh_AF),
acs_pop_5p = sum(acs_pop_5p_AF),
acs_lep_pop = sum(acs_lep_pop_AF),
bg_pop75p = sum(bg_pop75p_AF),
bg_pop18u = sum(bg_pop18u_AF),
bg_totpop = sum(bg_totpop_AF)
)
buf_tract_acs <- tract_acs %>%
group_by_at(proj_id_field_name) %>%
summarise(
acs_noninst_pop = sum(acs_noninst_pop_AF),
acs_sr_noninst_pop = sum(acs_sr_noninst_pop_AF),
acs_disab_pop = sum(acs_disab_pop_AF),
acs_sr_disab_pop = sum(acs_sr_disab_pop_AF),
acs_pop16p = sum(acs_pop16p_AF),
acs_workers16p = sum(acs_workers16p_AF)
)
buf_bg_cen$MinPerc <- round(buf_bg_cen$MinPop/buf_bg_cen$TotalPop,2)
buf_bg_acs$lt_2x_pov_perc <- round(buf_bg_acs$lt_2x_pov_est / buf_bg_acs$pov_stat_det_est,2)
buf_bg_acs$hh_0veh_perc <- round(buf_bg_acs$acs_0veh_hh / buf_bg_acs$acs_hh,2)
buf_bg_acs$low_inc_hh_perc <- round(buf_bg_acs$acs_low_inc_hh / buf_bg_acs$acs_tot_hh,2)
buf_bg_acs$lep_perc <- round(buf_bg_acs$acs_lep_pop / buf_bg_acs$acs_pop_5p,2)
buf_bg_acs$p75_perc <- round(buf_bg_acs$bg_pop75p / buf_bg_acs$bg_totpop,2)
buf_bg_acs$u18_perc <- round(buf_bg_acs$bg_pop18u / buf_bg_acs$bg_totpop,2)
buf_tract_acs$disab_perc <- round(buf_tract_acs$acs_disab_pop / buf_tract_acs$acs_noninst_pop,2)
buf_tract_acs$sr_disab_perc <- round(buf_tract_acs$acs_sr_disab_pop / buf_tract_acs$acs_sr_noninst_pop,2)
buf_tract_acs$workers16p_perc <- round(buf_tract_acs$acs_workers16p / buf_tract_acs$acs_pop16p,2)
buf_bg <- merge(buf_bg_acs, buf_bg_cen, by=proj_id_field_name)
all_vars <- merge(buf_bg, buf_tract_acs, by=proj_id_field_name)
all_vars_round_pops <- all_vars %>%
mutate(
MinPop_round = round(MinPop,0),
TotalPop_round = round(TotalPop,0),
lt_2x_pov_est_round = round(lt_2x_pov_est,0),
lep_round = round(acs_lep_pop),
u18_round = round(bg_pop18u,0),
p75_round = round(bg_pop75p,0),
disab_round = round(acs_disab_pop,0),
.keep = c("all")
)
# possible_fields <- c(TotalPop_round,
#   MinPop_round,
#   MinPerc,
#   lt_2x_pov_est_round,
#   lt_2x_pov_perc,
#   lep_round,
#   lep_perc,
#   u18_round,
#   u18_perc,
#   p75_round,
#   p75_perc,
#   disab_round,
#   disab_perc)
final <- all_vars_round_pops %>% select(
all_of(proj_id_field_name),
TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc
)
write.csv(final, output_table)
# qc
all_bgs <- read.csv('\\Users\\sstrumwasser.AD\\Documents\\ArcGIS\\Projects\\TIP_scroing_networks_3.0\\suffolk_freight_area_fractions_bg.csv')
bg_cen <- merge(all_bgs %>% select(geoid), bg20, by.x ='geoid', by.y ='GEOID')
sum_test <- sum(bg_cen$P2_001N)
View(final)
buf_bg <- merge(buf_bg_acs, buf_bg_cen, by=proj_id_field_name)
all_vars <- merge(buf_bg, buf_tract_acs, by=proj_id_field_name)
all_vars_round_pops <- all_vars %>%
mutate(
MinPop_round = round(MinPop,0),
TotalPop_round = round(TotalPop,0),
lt_2x_pov_est_round = round(lt_2x_pov_est,0),
lep_round = round(acs_lep_pop),
u18_round = round(bg_pop18u,0),
p75_round = round(bg_pop75p,0),
disab_round = round(acs_disab_pop,0),
.keep = c("all")
)
possible_fields <- c(TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc,
u18_round,
u18_perc,
p75_round,
p75_perc,
disab_round,
disab_perc)
buf_bg <- merge(buf_bg_acs, buf_bg_cen, by=proj_id_field_name)
all_vars <- merge(buf_bg, buf_tract_acs, by=proj_id_field_name)
all_vars_round_pops <- all_vars %>%
mutate(
MinPop_round = round(MinPop,0),
TotalPop_round = round(TotalPop,0),
lt_2x_pov_est_round = round(lt_2x_pov_est,0),
lep_round = round(acs_lep_pop),
u18_round = round(bg_pop18u,0),
p75_round = round(bg_pop75p,0),
disab_round = round(acs_disab_pop,0),
.keep = c("all")
)
# possible_fields <- c(TotalPop_round,
#   MinPop_round,
#   MinPerc,
#   lt_2x_pov_est_round,
#   lt_2x_pov_perc,
#   lep_round,
#   lep_perc,
#   u18_round,
#   u18_perc,
#   p75_round,
#   p75_perc,
#   disab_round,
#   disab_perc)
final <- all_vars_round_pops %>% select(
all_of(proj_id_field_name),
TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc,
u18_round,
u18_perc,
p75_round,
p75_perc,
disab_round,
disab_perc
)
write.csv(final, output_table)
View(final)
View(buf_bg)
View(bg_cen)
View(bg_cen20)
View(buf_bg_cen)
View(bg_cen20)
View(bg20)
View(bg_cen20)
View(bg_cen)
View(all_bgs)
View(all_vars)
View(all_vars_round_pops)
View(acsbgs)
View(bg_cen)
View(buf_bg_cen)
View(buf_bg)
# tables for each input geometry/census geometry combination
home_dir <- "C:/Users/sstrumwasser.AD/Documents/TIP_Equity23/arcpy_outputs/"
input_csvs_bg <- read_csv(paste(home_dir, "TIP_scoring_24_28_twoExtra_bgs_area_fractions.csv", sep=""))
input_csvs_tract <- read_csv(paste(home_dir, "TIP_scoring_24_28_twoExtra_tracts_area_fractions.csv", sep=""))
bg_cen20 <- do.call("rbind", list(input_csvs_bg))
tract_cen20 <- do.call("rbind", list(input_csvs_tract))
proj_id_field_name <- colnames(input_csvs_bg)[2]
# Access to Infrastructure version
# tip_bg_cen20 <- read.csv("C:\\Users\\sstrumwasser.AD\\Documents\\Access_to_Infrastructure\\outputs\\bluebikes_area_fractions_bg_point5_mi.csv")
#
# tip_tract_cen20 <- read.csv("C:\\Users\\sstrumwasser.AD\\Documents\\Access_to_Infrastructure\\outputs\\bluebikes_area_fractions_tract_point5_mi.csv")
# clean up!
rm(acs_noninst_pop,acs_sr_noninst_pop,acs_disabled_pop,acs_sr_disab_pop,
acs_hh,acs_0veh_hh,acs_low_inc_hh,acs_pop_5p,acs_lep_pop,pov_stat_det_est,
pov_stat_det_moe,lt_2x_pov_est,lt_2x_pov_moe,acs_pop16p,acs_workers16p,
acs_workers16p_shr,acs_pop75p,acs_pop18u)
bg_acs <- merge(bg_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), acsbgs, by.x =char('geoid'), by.y ='GEOID')
bg_acs[is.na(bg_acs)] <- 0
tract_acs <- merge(tract_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), acstrts, by.x ='geoid', by.y ='GEOID')
tract_acs[is.na(tract_acs)] <- 0
bg_cen <- merge(bg_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), bg20, by.x ='geoid', by.y ='GEOID')
bg_cen[is.na(bg_cen)] <- 0
#2020 Census
bg_cen$TotalPop_AF <- round(bg_cen$P2_001N*bg_cen$area_fraction)
bg_cen$MinPop_AF   <- round(bg_cen$MinPop*bg_cen$area_fraction)
#2020 ACS - BGs
#POV & 2x POV level
bg_acs$pov_stat_det_est_AF <- bg_acs$pov_stat_det_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_est_AF    <- bg_acs$lt_2x_pov_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_moe_AF    <- bg_acs$lt_2x_pov_moe*bg_acs$area_fraction
####HOUSEHOLDS - 0VEH AND LOWINC####
bg_acs$acs_hh_AF          <- bg_acs$acs_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_AF     <- bg_acs$acs_0veh_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_shr_AF <- bg_acs$acs_0veh_hh_shr*bg_acs$area_fraction
bg_acs$acs_tot_hh_AF      <- bg_acs$acs_tot_hh*bg_acs$area_fraction
bg_acs$acs_low_inc_hh_AF  <- bg_acs$acs_low_inc_hh*bg_acs$area_fraction
####LEP####
bg_acs$acs_pop_5p_AF  <- bg_acs$acs_pop_5p*bg_acs$area_fraction
bg_acs$acs_lep_pop_AF <- bg_acs$acs_lep_pop*bg_acs$area_fraction
####ACS AGE AND HH#####
bg_acs$bg_pop75p_AF <- bg_acs$bg_pop75p*bg_acs$area_fraction
bg_acs$bg_pop18u_AF <- bg_acs$bg_pop18u*bg_acs$area_fraction
bg_acs$bg_totpop_AF <- bg_acs$bg_totpop*bg_acs$area_fraction
#2020 ACS - Tracts
tract_acs$acs_noninst_pop_AF    <- tract_acs$acs_noninst_pop*tract_acs$area_fraction
tract_acs$acs_sr_noninst_pop_AF <- tract_acs$acs_sr_noninst_pop*tract_acs$area_fraction
tract_acs$acs_disab_pop_AF      <- tract_acs$acs_disab_pop*tract_acs$area_fraction
tract_acs$acs_sr_disab_pop_AF   <- tract_acs$acs_sr_disab_pop*tract_acs$area_fraction
tract_acs$acs_pop16p_AF         <- tract_acs$acs_pop16p*tract_acs$area_fraction
tract_acs$acs_workers16p_AF     <- tract_acs$acs_workers16p*tract_acs$area_fraction
buf_bg_cen <- bg_cen %>% group_by_at(proj_id_field_name) %>% summarise(
TotalPop = sum(TotalPop_AF),
MinPop = sum(MinPop_AF)
)
buf_bg_acs <- bg_acs %>% group_by_at(proj_id_field_name) %>% summarise(
pov_stat_det_est = sum(pov_stat_det_est_AF),
lt_2x_pov_est = sum(lt_2x_pov_est_AF),
lt_2x_pov_moe = sum(lt_2x_pov_moe_AF),
acs_hh = sum(acs_hh_AF),
acs_0veh_hh = sum(acs_0veh_hh_AF),
acs_0veh_hh_shr = sum(acs_0veh_hh_shr_AF),
acs_tot_hh = sum(acs_tot_hh_AF),
acs_low_inc_hh = sum(acs_low_inc_hh_AF),
acs_pop_5p = sum(acs_pop_5p_AF),
acs_lep_pop = sum(acs_lep_pop_AF),
bg_pop75p = sum(bg_pop75p_AF),
bg_pop18u = sum(bg_pop18u_AF),
bg_totpop = sum(bg_totpop_AF)
)
buf_tract_acs <- tract_acs %>%
group_by_at(proj_id_field_name) %>%
summarise(
acs_noninst_pop = sum(acs_noninst_pop_AF),
acs_sr_noninst_pop = sum(acs_sr_noninst_pop_AF),
acs_disab_pop = sum(acs_disab_pop_AF),
acs_sr_disab_pop = sum(acs_sr_disab_pop_AF),
acs_pop16p = sum(acs_pop16p_AF),
acs_workers16p = sum(acs_workers16p_AF)
)
buf_bg_cen$MinPerc <- round(buf_bg_cen$MinPop/buf_bg_cen$TotalPop,2)
buf_bg_acs$lt_2x_pov_perc <- round(buf_bg_acs$lt_2x_pov_est / buf_bg_acs$pov_stat_det_est,2)
buf_bg_acs$hh_0veh_perc <- round(buf_bg_acs$acs_0veh_hh / buf_bg_acs$acs_hh,2)
buf_bg_acs$low_inc_hh_perc <- round(buf_bg_acs$acs_low_inc_hh / buf_bg_acs$acs_tot_hh,2)
buf_bg_acs$lep_perc <- round(buf_bg_acs$acs_lep_pop / buf_bg_acs$acs_pop_5p,2)
buf_bg_acs$p75_perc <- round(buf_bg_acs$bg_pop75p / buf_bg_acs$bg_totpop,2)
buf_bg_acs$u18_perc <- round(buf_bg_acs$bg_pop18u / buf_bg_acs$bg_totpop,2)
buf_tract_acs$disab_perc <- round(buf_tract_acs$acs_disab_pop / buf_tract_acs$acs_noninst_pop,2)
buf_tract_acs$sr_disab_perc <- round(buf_tract_acs$acs_sr_disab_pop / buf_tract_acs$acs_sr_noninst_pop,2)
buf_tract_acs$workers16p_perc <- round(buf_tract_acs$acs_workers16p / buf_tract_acs$acs_pop16p,2)
buf_bg <- merge(buf_bg_acs, buf_bg_cen, by=proj_id_field_name)
all_vars <- merge(buf_bg, buf_tract_acs, by=proj_id_field_name)
all_vars_round_pops <- all_vars %>%
mutate(
MinPop_round = round(MinPop,0),
TotalPop_round = round(TotalPop,0),
lt_2x_pov_est_round = round(lt_2x_pov_est,0),
lep_round = round(acs_lep_pop),
u18_round = round(bg_pop18u,0),
p75_round = round(bg_pop75p,0),
disab_round = round(acs_disab_pop,0),
.keep = c("all")
)
# possible_fields <- c(TotalPop_round,
#   MinPop_round,
#   MinPerc,
#   lt_2x_pov_est_round,
#   lt_2x_pov_perc,
#   lep_round,
#   lep_perc,
#   u18_round,
#   u18_perc,
#   p75_round,
#   p75_perc,
#   disab_round,
#   disab_perc)
final <- all_vars_round_pops %>% select(
all_of(proj_id_field_name),
TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc,
u18_round,
u18_perc,
p75_round,
p75_perc,
disab_round,
disab_perc
)
write.csv(final, output_table)
# qc
all_bgs <- read.csv('\\Users\\sstrumwasser.AD\\Documents\\ArcGIS\\Projects\\TIP_scroing_networks_3.0\\suffolk_freight_area_fractions_bg.csv')
bg_cen <- merge(all_bgs %>% select(geoid), bg20, by.x ='geoid', by.y ='GEOID')
sum_test <- sum(bg_cen$P2_001N)
View(bg_cen)
View(final)
View(bg_cen)
View(buf_bg_cen)
View(buf_bg)
View(buf_bg_acs)
View(bg_cen)
View(tip_bg_cen)
View(bg_acs)
View(tract_cen20)
View(buf_bg)
View(buf_bg_acs)
View(bg_cen)
df = data.frame(c('a','b','c'),
c(1,2,3))
View(df)
df$test = 'test'
View(df)
#2020 Census
bg_cen$TotalPop_AF <- round(bg_cen$P2_001N*bg_cen$area_fraction)
View(bg_cen)
View(bg20)
View(bg_cen20)
bg_cen <- merge(bg_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), bg20, by.x ='geoid', by.y ='GEOID')
View(bg_cen)
bg_acs <- merge(bg_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), acsbgs, by.x =char('geoid'), by.y ='GEOID')
bg_acs[is.na(bg_acs)] <- 0
tract_acs <- merge(tract_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), acstrts, by.x ='geoid', by.y ='GEOID')
tract_acs[is.na(tract_acs)] <- 0
bg_cen <- merge(bg_cen20 %>% select(geoid, area_fraction, all_of(proj_id_field_name)), bg20, by.x ='geoid', by.y ='GEOID')
bg_cen[is.na(bg_cen)] <- 0
#2020 Census
bg_cen$TotalPop_AF <- round(bg_cen$P2_001N*bg_cen$area_fraction)
bg_cen$MinPop_AF   <- round(bg_cen$MinPop*bg_cen$area_fraction)
#2020 ACS - BGs
#POV & 2x POV level
bg_acs$pov_stat_det_est_AF <- bg_acs$pov_stat_det_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_est_AF    <- bg_acs$lt_2x_pov_est*bg_acs$area_fraction
bg_acs$lt_2x_pov_moe_AF    <- bg_acs$lt_2x_pov_moe*bg_acs$area_fraction
####HOUSEHOLDS - 0VEH AND LOWINC####
bg_acs$acs_hh_AF          <- bg_acs$acs_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_AF     <- bg_acs$acs_0veh_hh*bg_acs$area_fraction
bg_acs$acs_0veh_hh_shr_AF <- bg_acs$acs_0veh_hh_shr*bg_acs$area_fraction
bg_acs$acs_tot_hh_AF      <- bg_acs$acs_tot_hh*bg_acs$area_fraction
bg_acs$acs_low_inc_hh_AF  <- bg_acs$acs_low_inc_hh*bg_acs$area_fraction
####LEP####
bg_acs$acs_pop_5p_AF  <- bg_acs$acs_pop_5p*bg_acs$area_fraction
bg_acs$acs_lep_pop_AF <- bg_acs$acs_lep_pop*bg_acs$area_fraction
####ACS AGE AND HH#####
bg_acs$bg_pop75p_AF <- bg_acs$bg_pop75p*bg_acs$area_fraction
bg_acs$bg_pop18u_AF <- bg_acs$bg_pop18u*bg_acs$area_fraction
bg_acs$bg_totpop_AF <- bg_acs$bg_totpop*bg_acs$area_fraction
#2020 ACS - Tracts
tract_acs$acs_noninst_pop_AF    <- tract_acs$acs_noninst_pop*tract_acs$area_fraction
tract_acs$acs_sr_noninst_pop_AF <- tract_acs$acs_sr_noninst_pop*tract_acs$area_fraction
tract_acs$acs_disab_pop_AF      <- tract_acs$acs_disab_pop*tract_acs$area_fraction
tract_acs$acs_sr_disab_pop_AF   <- tract_acs$acs_sr_disab_pop*tract_acs$area_fraction
tract_acs$acs_pop16p_AF         <- tract_acs$acs_pop16p*tract_acs$area_fraction
tract_acs$acs_workers16p_AF     <- tract_acs$acs_workers16p*tract_acs$area_fraction
View(bg_cen)
buf_bg_cen <- bg_cen %>% group_by_at(proj_id_field_name) %>% summarise(
TotalPop = sum(TotalPop_AF),
MinPop = sum(MinPop_AF)
)
buf_bg_acs <- bg_acs %>% group_by_at(proj_id_field_name) %>% summarise(
pov_stat_det_est = sum(pov_stat_det_est_AF),
lt_2x_pov_est = sum(lt_2x_pov_est_AF),
lt_2x_pov_moe = sum(lt_2x_pov_moe_AF),
acs_hh = sum(acs_hh_AF),
acs_0veh_hh = sum(acs_0veh_hh_AF),
acs_0veh_hh_shr = sum(acs_0veh_hh_shr_AF),
acs_tot_hh = sum(acs_tot_hh_AF),
acs_low_inc_hh = sum(acs_low_inc_hh_AF),
acs_pop_5p = sum(acs_pop_5p_AF),
acs_lep_pop = sum(acs_lep_pop_AF),
bg_pop75p = sum(bg_pop75p_AF),
bg_pop18u = sum(bg_pop18u_AF),
bg_totpop = sum(bg_totpop_AF)
)
buf_tract_acs <- tract_acs %>%
group_by_at(proj_id_field_name) %>%
summarise(
acs_noninst_pop = sum(acs_noninst_pop_AF),
acs_sr_noninst_pop = sum(acs_sr_noninst_pop_AF),
acs_disab_pop = sum(acs_disab_pop_AF),
acs_sr_disab_pop = sum(acs_sr_disab_pop_AF),
acs_pop16p = sum(acs_pop16p_AF),
acs_workers16p = sum(acs_workers16p_AF)
)
buf_bg_cen$MinPerc <- round(buf_bg_cen$MinPop/buf_bg_cen$TotalPop,2)
buf_bg_acs$lt_2x_pov_perc <- round(buf_bg_acs$lt_2x_pov_est / buf_bg_acs$pov_stat_det_est,2)
buf_bg_acs$hh_0veh_perc <- round(buf_bg_acs$acs_0veh_hh / buf_bg_acs$acs_hh,2)
buf_bg_acs$low_inc_hh_perc <- round(buf_bg_acs$acs_low_inc_hh / buf_bg_acs$acs_tot_hh,2)
buf_bg_acs$lep_perc <- round(buf_bg_acs$acs_lep_pop / buf_bg_acs$acs_pop_5p,2)
buf_bg_acs$p75_perc <- round(buf_bg_acs$bg_pop75p / buf_bg_acs$bg_totpop,2)
buf_bg_acs$u18_perc <- round(buf_bg_acs$bg_pop18u / buf_bg_acs$bg_totpop,2)
buf_tract_acs$disab_perc <- round(buf_tract_acs$acs_disab_pop / buf_tract_acs$acs_noninst_pop,2)
buf_tract_acs$sr_disab_perc <- round(buf_tract_acs$acs_sr_disab_pop / buf_tract_acs$acs_sr_noninst_pop,2)
buf_tract_acs$workers16p_perc <- round(buf_tract_acs$acs_workers16p / buf_tract_acs$acs_pop16p,2)
buf_bg <- merge(buf_bg_acs, buf_bg_cen, by=proj_id_field_name)
all_vars <- merge(buf_bg, buf_tract_acs, by=proj_id_field_name)
all_vars_round_pops <- all_vars %>%
mutate(
MinPop_round = round(MinPop,0),
TotalPop_round = round(TotalPop,0),
lt_2x_pov_est_round = round(lt_2x_pov_est,0),
lep_round = round(acs_lep_pop),
u18_round = round(bg_pop18u,0),
p75_round = round(bg_pop75p,0),
disab_round = round(acs_disab_pop,0),
.keep = c("all")
)
# possible_fields <- c(TotalPop_round,
#   MinPop_round,
#   MinPerc,
#   lt_2x_pov_est_round,
#   lt_2x_pov_perc,
#   lep_round,
#   lep_perc,
#   u18_round,
#   u18_perc,
#   p75_round,
#   p75_perc,
#   disab_round,
#   disab_perc)
final <- all_vars_round_pops %>% select(
all_of(proj_id_field_name),
TotalPop_round,
MinPop_round,
MinPerc,
lt_2x_pov_est_round,
lt_2x_pov_perc,
lep_round,
lep_perc,
u18_round,
u18_perc,
p75_round,
p75_perc,
disab_round,
disab_perc
)
write.csv(final, output_table)
View(final)
View(buf_bg)
View(bg_cen)
View(final)
